{% extends "player_base.html" %}
{% load static %}

{% block title %}Team Members{% endblock %}

{% block content %}
<style>
    .team-members-wrapper {
        margin: 1.5rem auto;
        max-width: 1100px;
        font-family: system-ui, Arial, sans-serif;
    }
    .team-header {
        display:flex;
        justify-content:space-between;
        align-items:center;
        flex-wrap:wrap;
        gap:.75rem;
        margin-bottom:1rem;
    }
    table.team-table {
        width:100%;
        border-collapse:separate;
        border-spacing:0;
        background:rgba(255,255,255,0.25);
        backdrop-filter:blur(6px);
        -webkit-backdrop-filter:blur(6px);
        border:1px solid rgba(220,220,220,0.35);
        background:transparent !important;
        border-radius:10px;
        overflow:hidden;
    }
    table.team-table thead {
        background:linear-gradient(145deg, rgba(245,245,245,0.75), rgba(230,230,230,0.35));
    }
    table.team-table th, table.team-table td {
        padding:.75rem .9rem;
        text-align:left;
        font-size:.9rem;
        border-bottom:1px solid rgba(220,220,220,0.28);
    }
    table.team-table tr:last-child td {
        border-bottom:none;
    }
    table.team-table tbody tr:hover {
        background:rgba(255,255,255,0.45);
    }
    .captain-badge {
        display:inline-block;
        padding:.25rem .55rem;
        font-size:.65rem;
        letter-spacing:.5px;
        background:linear-gradient(135deg,#ffd772,#ffb347);
        color:#222;
        border:1px solid rgba(0,0,0,0.08);
        border-radius:20px;
        font-weight:600;
    }
    .assign-captain-form {
        display:flex;
        gap:.5rem;
        align-items:center;
    }
    .assign-captain-form select {
        padding:.45rem .6rem;
        border:1px solid rgba(180,180,180,0.6);
        background:rgba(250,250,250,0.85);
        border-radius:6px;
        font-size:.85rem;
    }
    .assign-captain-form button {
        padding:.48rem .9rem;
        border:none;
        background:#34495e;
        color:#fff;
        font-size:.75rem;
        letter-spacing:.5px;
        border-radius:6px;
        cursor:pointer;
        transition:background .2s;
    }
    .assign-captain-form button:hover {
        background:#2c3e50;
    }
    .status-pill {
        display:inline-block;
        padding:.25rem .55rem;
        font-size:.6rem;
        border:1px solid rgba(160,160,160,0.5);
        border-radius:14px;
        background:rgba(240,240,240,0.55);
        text-transform:uppercase;
        letter-spacing:.7px;
    }
    @media (max-width:750px){
        table.team-table th, table.team-table td { font-size:.75rem; padding:.55rem .6rem; }
        .assign-captain-form { flex-wrap:wrap; }
    }
</style>
<div class="team-members-wrapper">
    <div class="team-header">
        <h2>{{ team.name }} Members</h2>
    </div>

    <table class="team-table">
        <thead>
            <tr>
                <th style="width:110px;">Role</th>
                <th>Name</th>
                <th>Username</th>
                <th>Email</th>
                <th style="width:120px;">Status</th>
            </tr>
            {% if not captain and coach and request.user.id == coach.player.id %}
            <tr>
                <th colspan="5" style="background:rgba(255,255,255,0.35);">
                    <form method="post" action="#" class="assign-captain-form">
                        {% csrf_token %}
                        <label for="captain_player" style="font-size:.7rem; font-weight:600; letter-spacing:.5px;">Assign Captain:</label>
                        <select id="captain_player" name="player_id" required>
                            <option value="" disabled selected>Select member</option>
                            {% for team_player in team_players %}
                                {% if not team_player.player.is_coach %}
                                    <option value="{{ team_player.player.id }}">
                                        {{ team_player.player.name }}
                                    </option>
                                {% endif %}
                            {% endfor %}
                        </select>
                        <button type="submit">Set</button>
                    </form>
                </th>
            </tr>
            {% endif %}</option></select></th>
        </thead>
        <tbody>
        {% if coach %}
            <tr>
                <td><span class="captain-badge">COACH</span></td>
                <td>
                    {{ coach.player.get_full_name|default:coach.player.name|default:coach.player.username }}
                </td>
                <td>{{ coach.player.username }}</td>
                <td>{{ coach.player.email }}</td>
                <td><span class="status-pill">Active</span></td>
            </tr>
        {% endif %}

        {% if captain %}
            <tr>
                <td><span class="captain-badge">CAPTAIN</span></td>
                <td>
                    {{ captain.player.get_full_name|default:captain.player.name|default:captain.player.username }}
                </td>
                <td>{{ captain.player.username }}</td>
                <td>{{ captain.player.email }}</td>
                <td><span class="status-pill">Active</span></td>
            </tr>
        {% endif %}

        {% for team_player in team_players %}
            <tr>
                <td>
                    {% if team_player.player.is_coach %}
                        <span class="captain-badge">COACH</span>
                    {% else %}
                        <span class="status-pill">Player</span>
                    {% if not captain and request.user.id == team_player.player.id %}
                        <form method="post" action="#" style="display:inline-block; margin-left:.35rem;">
                            {% csrf_token %}
                            <input type="hidden" name="player_id" value="{{ team_player.player.id }}">
                            <button type="submit" class="become-captain-btn">Become Captain</button>
                        </form>
                        <!-- Styles for the Become Captain button.
                            The button element itself is a few lines above:
                            <button type="submit" class="become-captain-btn">Become Captain</button>
                            It only renders when there is no captain AND the row's player is the logged-in user. -->
                        <style>
                            .become-captain-btn{
                               padding:.38rem .8rem;
                               font-size:.6rem;
                               font-weight:600;
                               letter-spacing:.7px;
                               text-transform:uppercase;
                               background:linear-gradient(135deg,#36d1dc,#5b86e5);
                               color:#fff;
                               border:none;
                               border-radius:18px;
                               cursor:pointer;
                               box-shadow:0 2px 4px rgba(0,0,0,0.15);
                               transition:background .25s, transform .15s;
                            }
                            .become-captain-btn:hover{
                               background:linear-gradient(135deg,#2fabb5,#4a6fc5);
                            }
                            .become-captain-btn:active{
                               transform:translateY(1px);
                            }
                        </style>
                    {% endif %}
                    {% endif %}
                </td>
                <td>
                    {{ team_player.player.name }}
                </td>
                <td>{{ team_player.player.username }}</td>
                <td>{{ team_player.player.email }}</td>
                <td><span class="status-pill">Active</span></td>
            </tr>
        {% empty %}
            <tr>
                <td colspan="5">No members found.</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}</div></select></div>